<!doctype html>

<html>
	<head>
		<title>Mixology Quiz, Spring 2018, xAPI Cohort</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1.0">
        <script src="xapiwrapper.min.js"></script>
	</head>

	<body>
        
        <div id="quiz"></div>
        <button id="submit">Submit Quiz</button>
        <div id="results"></div>
        
        <script>
            
        // Configure xapiwrapper to work with the Veracity LRS
        var conf = {
         'endpoint': 'https://videocohort.lrs.io:443/xapi/',
         'user': 'videocohort',
         'password': '1827364vodeo345',
      };    
        
      ADL.XAPIWrapper.changeConfig(conf);
            
            
            (function() {
  function buildQuiz() {
    // storage place for HTML output
    const output = [];

    // for each question...
    myQuestions.forEach((currentQuestion, questionNumber) => {
      // for storing the list of answer choices
      const answers = [];

      // and for each available answer...
      for (letter in currentQuestion.answers) {
        // ...add an HTML radio button
        answers.push(
          `<label>
            <input type="radio" name="question${questionNumber}" value="${letter}">
            ${letter} :
            ${currentQuestion.answers[letter]} <br />
          </label>`
        );
      }

      // add this question and its answers to the output
      output.push(
        `<div class="question"> ${currentQuestion.question} </div>
        <div class="answers"> ${answers.join("")} </div> 
        <div><br /></div>`
      );
    });

    // combine our output list into one string of HTML and put it on the page
    quizContainer.innerHTML = output.join("");
  }

  function showResults() {
    // gather answer containers from our quiz
    const answerContainers = quizContainer.querySelectorAll(".answers");

    // keep track of user's answers
    let numCorrect = 0;

    // for each question...
    myQuestions.forEach((currentQuestion, questionNumber) => {
      // find selected answer
      const answerContainer = answerContainers[questionNumber];
      const selector = `input[name=question${questionNumber}]:checked`;
      const userAnswer = (answerContainer.querySelector(selector) || {}).value;

      // if answer is correct
      if (userAnswer === currentQuestion.correctAnswer) {
        // add to the number of correct answers
        numCorrect++;

        // color the answers green
        answerContainers[questionNumber].style.color = "lightgreen";
      
        //send the xAPIstatement
        answered(currentQuestion,myQuestions.correctAnswer);
      
      // Used to capture an answer selection
      function answered(currentQuestion, correctAnswer) {        
        var statement = {
            "actor": {
                "mbox": "mailto:gimp.user@xapicohort.com",
                "name": "GIMP user",
                "objectType": "Agent"
            },
            "verb": {
                "id": "http://adlnet.gov/expapi/verbs/responded",
                "display": {
                    "en-US": "responded"
                }
            },
            "object": {
                "id": "http://adlnet.gov/expapi/tutorials/xapiwrapper/",
                "definition": {
                    "name": {
                        "en-US": "Question: " + currentQuestion.question
                    },
                    "description": {
                        "en-US": currentQuestion.question
                    },
                    "correctResponsesPattern": [
                        currentQuestion.correctAnswer
                    ],
                    "interactionType": "choice",
                    "type": "http://adlnet.gov/expapi/activities/interaction",
                    "choices": [
                        {
                            "id": "Choice-a",
                            "description": {
                                "en-US": currentQuestion.answers.a
                            }
                        },
                        {
                            "id": "Choice-b",
                            "description": {
                                "en-US": currentQuestion.answers.b
                            }
                        },
                        {
                            "id": "Choice-c",
                            "description": {
                                "en-US": currentQuestion.answers.c
                            }
                        },
                        {
                            "id": "Choice-d",
                            "description": {
                                "en-US": currentQuestion.answers.d
                            }
                        }
                    ]
                },
                "objectType": "Activity"
            },
            "result": {
                "duration": "PT0H2M30.76S",
                "response": currentQuestion.correctAnswer,
                "success": true
            },
            "context": {
                "contextActivities": {
                    
                    "category": [
                        {
                            "definition": {
                            "type": "http://adlnet.gov/expapi/activities/profile"
                            },
                            "id": "https://w3id.org/xapi/scorm"
                            },
                            {
                            "definition": {
                            "type": "http://adlnet.gov/expapi/activities/profile"
                            },
                            "id": "https://w3id.org/xapi/netc"
                        }
                        ],
                    "parent": [
                        {
                        "definition": {
                        "type": "http://adlnet.gov/expapi/activities/lesson",
                        "description": {

                        "en-US": "Assessment"
                        }
                        },
                        "id": "iri://unique-identifer-matches-identifier-from-sco-in-manifest", "objectType": "Activity"
                        }
                        ],
                    
                    "grouping": [
                        {
                        "definition": {
                            "type": "http://adlnet.gov/expapi/activities/attempt"
                        },
                        "id": "rrl://ORG-aec61309",
                        "objectType": "Activity"
                        },
                        {
                        "definition": {
                            "type": "http://adlnet.gov/expapi/activities/course",
                            "description": {
                                "en-US": "Course Name"
                            }
                        },
                        "id": "http://adlnet.gov/expapi/tutorials/xapiwrapper/",
                        "objectType": "Activity"
                        }
                    ]
                }
            }
        };
        ADL.XAPIWrapper.sendStatement(statement, function(){}); // adding an empty function at the end of sendStatement tells it to fire async
      }
            
      } //end of if
        
        else {
        // if answer is wrong or blank
        // color the answers red
        answerContainers[questionNumber].style.color = "red";
      
            
        //send the xAPIstatement when answered incorrectly
        answeredIncorrect(currentQuestion,myQuestions.correctAnswer, userAnswer);
      
      // Used to capture an answer selection
      function answeredIncorrect(currentQuestion, correctAnswer, userAnswer) {        
        var statement = {
            "actor": {
                "mbox": "mailto:gimp.user@xapicohort.com",
                "name": "GIMP user",
                "objectType": "Agent"
            },
            "verb": {
                "id": "http://adlnet.gov/expapi/verbs/responded",
                "display": {
                    "en-US": "responded"
                }
            },
            "object": {
                "id": "http://adlnet.gov/expapi/tutorials/xapiwrapper/",
                "definition": {
                    "name": {
                        "en-US": "Question: " + currentQuestion.question
                    },
                    "description": {
                        "en-US": currentQuestion.question
                    },
                    "correctResponsesPattern": [
                        currentQuestion.correctAnswer
                    ],
                    "interactionType": "choice",
                    "type": "http://adlnet.gov/expapi/activities/interaction",
                    "choices": [
                        {
                            "id": "Choice-a",
                            "description": {
                                "en-US": currentQuestion.answers.a
                            }
                        },
                        {
                            "id": "Choice-b",
                            "description": {
                                "en-US": currentQuestion.answers.b
                            }
                        },
                        {
                            "id": "Choice-c",
                            "description": {
                                "en-US": currentQuestion.answers.c
                            }
                        },
                        {
                            "id": "Choice-d",
                            "description": {
                                "en-US": currentQuestion.answers.d
                            }
                        }
                    ]
                },
                "objectType": "Activity"
            },
            "result": {
                "duration": "PT0H2M30.76S",
                "response": userAnswer,
                "success": false
            },
            "context": {
                "contextActivities": {
                    "category": [
                        {
                            "definition": {
                            "type": "http://adlnet.gov/expapi/activities/profile"
                            },
                            "id": "https://w3id.org/xapi/scorm"
                            },
                            {
                            "definition": {
                            "type": "http://adlnet.gov/expapi/activities/profile"
                            },
                            "id": "https://w3id.org/xapi/netc"
                        }
                        ],
                    "parent": [
                        {
                        "definition": {
                        "type": "http://adlnet.gov/expapi/activities/lesson",
                        "description": {

                        "en-US": "Assessment"
                        }
                        },
                        "id": "iri://unique-identifer-matches-identifier-from-sco-in-manifest", "objectType": "Activity"
                        }
                        ],
                    
                    "grouping": [
                        {
                        "definition": {
                            "type": "http://adlnet.gov/expapi/activities/attempt"
                        },
                        "id": "rrl://ORG-aec61309",
                        "objectType": "Activity"
                        },
                        {
                        "definition": {
                            "type": "http://adlnet.gov/expapi/activities/course",
                            "description": {
                                "en-US": "Course Name"
                            }
                        },
                        "id": "http://adlnet.gov/expapi/tutorials/xapiwrapper/",
                        "objectType": "Activity"
                        }
                    ]
                }
            }
        };
        ADL.XAPIWrapper.sendStatement(statement, function(){}); // adding an empty function at the end of sendStatement tells it to fire async
      } 
                    
      } //end of else
    });

    // show number of correct answers out of total
    resultsContainer.innerHTML = `You scored ${numCorrect} out of ${myQuestions.length}.`;
  }

  const quizContainer = document.getElementById("quiz");
  const resultsContainer = document.getElementById("results");
  const submitButton = document.getElementById("submit");
  const myQuestions = [
    
  //************************ QUESTIONS BEGIN HERE *************************  
            
    {
      question: "The mojito originated in",
      answers: {
        a: "Jamaica",
        b: "Mexico",
        c: "Cuba",
        d: "Puerto Rico"
      },
      correctAnswer: "c"
    },
    {
      question: "The four main ingredients to a mojito are",
      answers: {
        a: "White rum, grapefruit juice, sugar and carbonated water",
        b: "White rum, club soda, sugar and lime",
        c: "Tequila, club soda, sugar and lime",
        d: "Dark rum, ginger ale, demerara syrup and lime"
      },
      correctAnswer: "b"
    },
    {
      question: "The four main ingredients to a mint julep are",
      answers: {
        a: "Vodka, seltzer water, lemon slices, sugar",
        b: "White Whiskey, club soda, mint leaves, sugar",
        c: "Whiskey, grapefruit juice, mint leaves, honey syrup",
        d: "Kentucky Bourbon, seltzer water, mint leaves, sugar"
      },
      correctAnswer: "d"
    },
    {
      question: "At a minimum, these three things go into a Bloody Mary",
      answers: {
        a: "Vodka, Tomato juice, tabasco sauce",
        b: "Gin, club soda, lime wedges",
        c: "Dark rum, lime juice, demerara syrup",
        d: "Vermouth, orange bitters, seltzer water"
      },
      correctAnswer: "a"
    },
    {
      question: "Which U.S. sporting event is the Mint Julep cocktail associated with",
      answers: {
        a: "The US Open",
        b: "The Kentucky Derby",
        c: "The World Series",
        d: "The Indianapolis 500"
      },
      correctAnswer: "b"
    },
    {
      question: "During its creation, mixing the contents of a Bloody Mary is done by",
      answers: {
        a: "using a blender",
        b: "using a drink shaker",
        c: "using a bar spoon",
        d: "rolling the contents from glass to glass"
      },
      correctAnswer: "d"
    }
      
    //************************ QUESTIONS END HERE *************************        
  
  ];

  // display quiz right away
  buildQuiz();

  // on submit, show results
  submitButton.addEventListener("click", showResults);
})();
        </script>
	</body>
</html>